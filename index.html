<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KjugeBloc</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&family=Libre+Baskerville:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="images/logo/tab_icon.png" type="image/png" />
</head>
<body>
  
  <header class="site-header">
    <div class="header-content">
      <div class="site-branding">
        <img src="images/logo/front-icon_rocks.png" alt="KjugeBloc logo" class="logo">
        <h1>KjugeBloc</h1>
      </div>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html" class="active">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="access.html">Access</a></li>
          <li><a href="area-index.html">Area Index</a></li>
          <li><a href="map.html">Map</a></li>
          <li><a href="store.html">Store</a></li>
          <li style="padding-right: 10px;">
            <a href="#">
              <img src="images/logo/search-icon.png" alt="Search" style="height: 18px; vertical-align: middle;">
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section id="main-intro" class="two-column" style="display:none">
      <div class="left-column">
        <p>The purpose of this site is to provide information about the climbing in and around Kjugekull â€“ by many considered Sweden's best area for bouldering.</p>
  
        <p class="left-column-italics">Please feel free to <a href="mailto:kjugebloc@gmail.com" style="text-decoration: underline; color: inherit;">contribute</a> by reporting a new climb, sending in photos/videos or other information.<span style="display: block; margin-top: 10px;">It's highly appreciated!</span></p>
      
        <p id="climb-count-text">The KjugeBloc database currently features <span id="climb-count" class="HL-text"></span> boulderproblems across <span id="area-count" class="HL-text"></span> unique areas. Browse the <span class="HL2-text">Area Index</span> to explore problems and first ascentionists, or navigate the <span class="HL2-text">Map</span> to locate sectors and parkings. Visit the <span class="HL2-text">About</span> page for an overview of local climbing ethics and a breakdown of how problems are described â€” including grades, ratings, and styles.</p>
        
        <p>Also be sure to read the <span class="HL2-text">Access</span> page, where you'll find general guidelines for behavior in the forest, along with important information about nature reserves.</p>

        <p>Finally, if you'd like to support KjugeBloc and help keep the site running,<br>check out the <span class="HL2-text">Store</span>!</p>

      </div>  
      <div class="right-column">
        <div class="image-wrapper">
          <img src="images/photos/front-photo_baltazar.jpg" alt="Description of image">
        </div>
      </div>
    </section>

    <section class="latest-climbs-container" style="display: none;">
      <h2>New Lines</h2>
      <ul id="latest-climbs"></ul>
    </section>
  </main>

  <footer style="display: none;">
    <p>Â© 2025 <b>KjugeBloc</b></p>
    <p>
      <a href="mailto:kjugebloc@gmail.com" style="color: inherit;">
        kjugebloc@gmail.com
      </a>
    </p>
  </footer>

  <script>
  const sheetId = '1VwZM08gTUNHlpWGDaBUWnYdiqgUFicWoD3fDJJwE7rU';
  const sheetName = 'databas';
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

  fetch(url)
    .then(res => res.text())
    .then(data => {
      const json = JSON.parse(data.substring(47).slice(0, -2));
      const rows = json.table.rows;

      const problems = rows.slice(1).map(row => {
        const cols = row.c;
        const timestamp = cols[0]?.v;
        const name = cols[8]?.v;
        const grade = cols[9]?.v || '';
        const rating = cols[12]?.v || '';
        const expo = cols[11]?.v || '';
        const faName = cols[15]?.v || '';
        const images = cols[18]?.v || '';
        const video = cols[17]?.v || '';
        const hasMedia = images.trim() !== '' || video.trim() !== '';

        if (timestamp && name) {
          return {
            timestamp,
            name,
            grade,
            rating,
            expo,
            faName,
            hasMedia
          };
        }
        return null;
      }).filter(Boolean);

      problems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      const latestList = document.getElementById('latest-climbs');
      problems.slice(0, 10).forEach(problem => {
        const cameraIcon = problem.hasMedia ? 'ðŸ“·' : '';
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="problem-row">
            <span class="camera-icon">${cameraIcon}</span>
            <a href="problem.html?name=${encodeURIComponent(problem.name)}" class="problem-name-link">
              <strong>${problem.name}</strong>
            </a>
            <span class="problem-meta">
              <span class="grade">${problem.grade}</span>
              <span class="rating">${problem.rating}</span>
              <span class="expo">${problem.expo}</span>
              ${problem.faName ? `<span class="fa-name">${problem.faName}</span>` : ''}
            </span>
          </div>
        `;
        latestList.appendChild(li);
      });
      document.querySelector('footer').style.display = 'block';

    })
    .catch(err => {
      console.error('Failed to load latest climbs:', err);
      document.getElementById('latest-climbs').innerHTML = '<li>Error loading data.</li>';
    });
  </script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const sheetId = '1VwZM08gTUNHlpWGDaBUWnYdiqgUFicWoD3fDJJwE7rU';
    const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=databas`;

    fetch(sheetUrl)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const rows = json.table.rows;

        const validClimbs = [];
        const uniqueAreas = new Set();

        rows.slice(1).forEach(row => {
          const cols = row.c;
          const grade = cols[9]?.v?.trim();
          const area = cols[2]?.v?.trim();

          if (grade && grade !== 'P' && grade !== '?') {
            validClimbs.push(row);
            if (area) {
              const normalized = area.startsWith('0') ? '0-group' : area;
              uniqueAreas.add(normalized);
            }
          }
        });

        const climbCount = validClimbs.length;
        const areaCount = uniqueAreas.size;

        const countEl = document.getElementById('climb-count');
        const areaEl = document.getElementById('area-count');
        const introSection = document.getElementById('main-intro');
        const latestSection = document.querySelector('.latest-climbs-container');
        const footer = document.querySelector('footer');

        if (countEl) countEl.textContent = climbCount;
        if (areaEl) areaEl.textContent = areaCount;
        if (introSection) introSection.style.display = 'flex';
        if (latestSection) latestSection.style.display = 'block';
        if (footer) footer.style.display = 'block';
      })
      .catch(err => {
        console.error('Failed to load climb and area data:', err);
      });
  });
</script>

</body>
</html>
